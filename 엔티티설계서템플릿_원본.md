# Entity ì„¤ê³„ì„œ

## ë¬¸ì„œ ì •ë³´
- **í”„ë¡œì íŠ¸ëª…**: [í”„ë¡œì íŠ¸ëª…]
- **ì‘ì„±ì**: [íŒ€ëª…/ì‘ì„±ìëª…]
- **ì‘ì„±ì¼**: [YYYY-MM-DD]
- **ë²„ì „**: [v1.0]
- **ê²€í† ì**: [ë°±ì—”ë“œ ê°œë°œìëª…]
- **ìŠ¹ì¸ì**: [íŒ€ ë¦¬ë”ëª…]

---

## 1. Entity ì„¤ê³„ ê°œìš”

### 1.1 ì„¤ê³„ ëª©ì 
> JPA Entity í´ë˜ìŠ¤ ì„¤ê³„ë¥¼ í†µí•´ ê°ì²´-ê´€ê³„ ë§¤í•‘(ORM)ì„ ì •ì˜í•˜ê³ , 
> ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì„ ì½”ë“œë¡œ í‘œí˜„í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ ì‹œìŠ¤í…œì„ êµ¬ì¶•

### 1.2 ì„¤ê³„ ì›ì¹™
- **ë‹¨ì¼ ì±…ì„ ì›ì¹™**: í•˜ë‚˜ì˜ EntityëŠ” í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê°œë…ë§Œ í‘œí˜„
- **ìº¡ìŠí™”**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ Entity ë‚´ë¶€ì— êµ¬í˜„
- **ë¶ˆë³€ì„±**: ê°€ëŠ¥í•œ í•œ ë¶ˆë³€ ê°ì²´ë¡œ ì„¤ê³„
- **ì—°ê´€ê´€ê³„ ìµœì†Œí™”**: í•„ìš”í•œ ê´€ê³„ë§Œ ë§¤í•‘í•˜ì—¬ ë³µì¡ë„ ê°ì†Œ

### 1.3 ê¸°ìˆ  ìŠ¤íƒ
- **ORM í”„ë ˆì„ì›Œí¬**: Spring Data JPA 2.7.x
- **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0
- **ê²€ì¦ í”„ë ˆì„ì›Œí¬**: Bean Validation 2.0
- **ê°ì‚¬ ê¸°ëŠ¥**: Spring Data JPA Auditing

---

## 2. Entity ëª©ë¡ ë° ë¶„ë¥˜

### 2.1 Entity ë¶„ë¥˜ ë§¤íŠ¸ë¦­ìŠ¤
|     Entityëª…      | ìœ í˜•  | ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ìš”ë„  | ê¸°ìˆ ì  ë³µì¡ë„   | ì—°ê´€ê´€ê³„ ìˆ˜   | ìš°ì„ ìˆœìœ„ |
|------------------ |------|----------------|---------------|-------------|---------|
| **Member**        | í•µì‹¬  |     ë†’ìŒ       |      ì¤‘ê°„      |     4ê°œ     |   1ìˆœìœ„ |
| **Book**          | í•µì‹¬  |     ë†’ìŒ       |      ì¤‘ê°„      |     3ê°œ     |   1ìˆœìœ„ |
| **Loan**          | í•µì‹¬  |     ë†’ìŒ       |      ë†’ìŒ      |     3ê°œ     |   1ìˆœìœ„ |
| **Category**      | ì§€ì›  |     ì¤‘ê°„       |      ë‚®ìŒ      |     2ê°œ     |   2ìˆœìœ„ |
| **Reservation**   | ì§€ì›  |     ì¤‘ê°„       |      ì¤‘ê°„      |     2ê°œ     |   2ìˆœìœ„ |
| **Admin**         | ì§€ì›  |     ì¤‘ê°„       |      ë‚®ìŒ      |     1ê°œ     |   3ìˆœìœ„ |
| **LoanHistory**   | ì´ë ¥  |     ë‚®ìŒ       |      ë‚®ìŒ      |     2ê°œ     |   3ìˆœìœ„ |

### 2.2 Entity ìƒì† êµ¬ì¡°
```mermaid
classDiagram
    class BaseEntity {
        <<abstract>>
        +Long id
        +LocalDateTime createdAt
        +LocalDateTime updatedAt
        +String createdBy
        +String lastModifiedBy
    }
    
    class BaseTimeEntity {
        <<abstract>>
        +LocalDateTime createdAt
        +LocalDateTime updatedAt
    }
    
    Member --|> BaseEntity
    Book --|> BaseEntity
    Loan --|> BaseEntity
    Category --|> BaseTimeEntity
    Reservation --|> BaseEntity
    Admin --|> BaseEntity
```

---

## 3. ê³µí†µ ì„¤ê³„ ê·œì¹™

### 3.1 ë„¤ì´ë° ê·œì¹™
| êµ¬ë¶„ | ê·œì¹™ | ì˜ˆì‹œ | ë¹„ê³  |
|------|------|------|------|
| **Entity í´ë˜ìŠ¤ëª…** | PascalCase | `Member`, `BookCategory` | ë‹¨ìˆ˜í˜• ì‚¬ìš© |
| **í…Œì´ë¸”ëª…** | snake_case | `members`, `book_categories` | ë³µìˆ˜í˜• ì‚¬ìš© |
| **ì»¬ëŸ¼ëª…** | snake_case | `member_id`, `created_at` | ì–¸ë”ìŠ¤ì½”ì–´ êµ¬ë¶„ |
| **ì—°ê´€ê´€ê³„ í•„ë“œ** | camelCase | `memberLoans`, `bookCategory` | ê°ì²´ ì°¸ì¡°ëª… |
| **boolean í•„ë“œ** | is + í˜•ìš©ì‚¬ | `isActive`, `isDeleted` | ëª…í™•í•œ ì˜ë¯¸ |

### 3.2 ê³µí†µ ì–´ë…¸í…Œì´ì…˜ ê·œì¹™
```java
// ê¸°ë³¸ Entity êµ¬ì¡°
@Entity
@Table(name = "í…Œì´ë¸”ëª…")
@EntityListeners(AuditingEntityListener.class)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Getter
public class EntityName extends BaseEntity {
    // í•„ë“œ ì •ì˜
}
```

### 3.3 ID ìƒì„± ì „ëµ
| Entity | ì „ëµ | ì´ìœ  | ì˜ˆì‹œ |
|--------|------|------|------|
| **Member** | IDENTITY | MySQL Auto Increment í™œìš© | 1, 2, 3, ... |
| **Book** | IDENTITY | ë‹¨ìˆœí•œ ìˆœì°¨ ì¦ê°€ | 1, 2, 3, ... |
| **Loan** | IDENTITY | ëŒ€ì¶œ ìˆœì„œ ë³´ì¥ | 1, 2, 3, ... |
| **Category** | IDENTITY | ê³„ì¸µ êµ¬ì¡° ì§€ì› | 1, 2, 3, ... |

---

## 4. ìƒì„¸ Entity ì„¤ê³„

### 4.1 Member Entity

#### 4.1.1 ê¸°ë³¸ ì •ë³´
```java
@Entity
@Table(name = "members", indexes = {
    @Index(name = "idx_member_number", columnList = "member_number"),
    @Index(name = "idx_email", columnList = "email"),
    @Index(name = "idx_status", columnList = "status")
})
@EntityListeners(AuditingEntityListener.class)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Getter
public class Member extends BaseEntity {
    // í•„ë“œ ì •ì˜ (ì•„ë˜ ìƒì„¸ ëª…ì„¸ ì°¸ì¡°)
}
```

#### 4.1.2 í•„ë“œ ìƒì„¸ ëª…ì„¸
| í•„ë“œëª… | ë°ì´í„° íƒ€ì… | ì»¬ëŸ¼ëª… | ì œì•½ì¡°ê±´ | ì„¤ëª… | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ |
|--------|-------------|--------|----------|------|---------------|
| **id** | `Long` | `member_id` | PK, NOT NULL, AUTO_INCREMENT | íšŒì› ê³ ìœ  ì‹ë³„ì | ì‹œìŠ¤í…œ ìë™ ìƒì„± |
| **memberNumber** | `String` | `member_number` | UNIQUE, NOT NULL, LENGTH(10) | íšŒì›ë²ˆí˜¸ | M + 9ìë¦¬ ìˆ«ì |
| **name** | `String` | `name` | NOT NULL, LENGTH(50) | íšŒì›ëª… | 2-50ì í•œê¸€/ì˜ë¬¸ |
| **email** | `String` | `email` | UNIQUE, NOT NULL, LENGTH(100) | ì´ë©”ì¼ | ë¡œê·¸ì¸ ID ê²¸ìš© |
| **password** | `String` | `password` | NOT NULL, LENGTH(255) | ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ | BCrypt ì•”í˜¸í™” |
| **phoneNumber** | `String` | `phone_number` | LENGTH(15) | ì „í™”ë²ˆí˜¸ | 010-1234-5678 í˜•ì‹ |
| **birthDate** | `LocalDate` | `birth_date` | NULL í—ˆìš© | ìƒë…„ì›”ì¼ | í†µê³„ ëª©ì  |
| **address** | `String` | `address` | LENGTH(200) | ì£¼ì†Œ | ì„ íƒ í•­ëª© |
| **status** | `MemberStatus` | `status` | NOT NULL, ENUM | íšŒì› ìƒíƒœ | ACTIVE, SUSPENDED, WITHDRAWN |
| **maxLoanCount** | `Integer` | `max_loan_count` | NOT NULL, DEFAULT(5) | ìµœëŒ€ ëŒ€ì¶œ ê¶Œìˆ˜ | 1-10 ë²”ìœ„ |

#### 4.1.3 ê²€ì¦ ì–´ë…¸í…Œì´ì…˜
```java
@Column(name = "member_number", unique = true, nullable = false, length = 10)
@Pattern(regexp = "^M\\d{9}$", message = "íšŒì›ë²ˆí˜¸ëŠ” Mìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 10ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤")
private String memberNumber;

@Column(nullable = false, length = 50)
@NotBlank(message = "ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
@Size(min = 2, max = 50, message = "ì´ë¦„ì€ 2-50ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤")
private String name;

@Column(unique = true, nullable = false, length = 100)
@Email(message = "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤")
@NotBlank(message = "ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
private String email;

@Column(name = "phone_number", length = 15)
@Pattern(regexp = "^\\d{2,3}-\\d{3,4}-\\d{4}$", 
         message = "ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤")
private String phoneNumber;

@Enumerated(EnumType.STRING)
@Column(nullable = false)
private MemberStatus status = MemberStatus.ACTIVE;

@Column(name = "max_loan_count", nullable = false)
@Min(value = 1, message = "ìµœëŒ€ ëŒ€ì¶œ ê¶Œìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
@Max(value = 10, message = "ìµœëŒ€ ëŒ€ì¶œ ê¶Œìˆ˜ëŠ” 10 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤")
private Integer maxLoanCount = 5;
```

#### 4.1.4 ì—°ê´€ê´€ê³„ ë§¤í•‘
```java
// 1:N - íšŒì›ì˜ ëŒ€ì¶œ ëª©ë¡
@OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
@OrderBy("createdAt DESC")
private List<Loan> loans = new ArrayList<>();

// 1:N - íšŒì›ì˜ ì˜ˆì•½ ëª©ë¡
@OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
@OrderBy("createdAt DESC")
private List<Reservation> reservations = new ArrayList<>();
```

#### 4.1.5 ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
```java
/**
 * ì¶”ê°€ ëŒ€ì¶œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
 * @return ëŒ€ì¶œ ê°€ëŠ¥í•˜ë©´ true
 */
public boolean canLoanMore() {
    long currentLoanCount = loans.stream()
        .filter(loan -> loan.getStatus() == LoanStatus.BORROWED)
        .count();
    return currentLoanCount < maxLoanCount && status == MemberStatus.ACTIVE;
}

/**
 * ì—°ì²´ ë„ì„œ ë³´ìœ  ì—¬ë¶€ í™•ì¸
 * @return ì—°ì²´ ë„ì„œê°€ ìˆìœ¼ë©´ true
 */
public boolean hasOverdueLoans() {
    return loans.stream()
        .anyMatch(loan -> loan.isOverdue());
}

/**
 * í˜„ì¬ ëŒ€ì¶œ ì¤‘ì¸ ë„ì„œ ìˆ˜ ì¡°íšŒ
 * @return ëŒ€ì¶œ ì¤‘ì¸ ë„ì„œ ìˆ˜
 */
public long getCurrentLoanCount() {
    return loans.stream()
        .filter(loan -> loan.getStatus() == LoanStatus.BORROWED)
        .count();
}

/**
 * íšŒì› ì •ë³´ ì—…ë°ì´íŠ¸
 * @param name ì´ë¦„
 * @param phoneNumber ì „í™”ë²ˆí˜¸
 * @param address ì£¼ì†Œ
 */
public void updateInfo(String name, String phoneNumber, String address) {
    if (StringUtils.hasText(name)) {
        this.name = name;
    }
    this.phoneNumber = phoneNumber;
    this.address = address;
}

/**
 * íšŒì› ìƒíƒœ ë³€ê²½
 * @param status ë³€ê²½í•  ìƒíƒœ
 * @param reason ë³€ê²½ ì‚¬ìœ 
 */
public void changeStatus(MemberStatus status, String reason) {
    if (this.status != status) {
        this.status = status;
        // ìƒíƒœ ë³€ê²½ ì´ë ¥ ê¸°ë¡ (ë³„ë„ Entity)
        // this.statusHistories.add(new MemberStatusHistory(this.status, status, reason));
    }
}
```

#### 4.1.6 ìƒì„±ì ë° íŒ©í† ë¦¬ ë©”ì„œë“œ
```java
@Builder
private Member(String memberNumber, String name, String email, String password, 
               String phoneNumber, LocalDate birthDate, String address) {
    this.memberNumber = memberNumber;
    this.name = name;
    this.email = email;
    this.password = password;
    this.phoneNumber = phoneNumber;
    this.birthDate = birthDate;
    this.address = address;
    this.status = MemberStatus.ACTIVE;
    this.maxLoanCount = 5;
}

/**
 * ìƒˆ íšŒì› ìƒì„± íŒ©í† ë¦¬ ë©”ì„œë“œ
 */
public static Member createMember(String name, String email, String password, 
                                 String phoneNumber, LocalDate birthDate, String address) {
    String memberNumber = generateMemberNumber(); // ë³„ë„ ì„œë¹„ìŠ¤ì—ì„œ ìƒì„±
    String encodedPassword = encodePassword(password); // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
    
    return Member.builder()
        .memberNumber(memberNumber)
        .name(name)
        .email(email)
        .password(encodedPassword)
        .phoneNumber(phoneNumber)
        .birthDate(birthDate)
        .address(address)
        .build();
}
```

### 4.2 Book Entity

#### 4.2.1 í•„ë“œ ìƒì„¸ ëª…ì„¸
| í•„ë“œëª… | ë°ì´í„° íƒ€ì… | ì»¬ëŸ¼ëª… | ì œì•½ì¡°ê±´ | ì„¤ëª… | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ |
|--------|-------------|--------|----------|------|---------------|
| **id** | `Long` | `book_id` | PK, NOT NULL, AUTO_INCREMENT | ë„ì„œ ê³ ìœ  ì‹ë³„ì | ì‹œìŠ¤í…œ ìë™ ìƒì„± |
| **isbn** | `String` | `isbn` | UNIQUE, NOT NULL, LENGTH(13) | ISBN | 13ìë¦¬ ìˆ«ìë§Œ |
| **title** | `String` | `title` | NOT NULL, LENGTH(200) | ë„ì„œëª… | í•„ìˆ˜ ì…ë ¥ |
| **author** | `String` | `author` | NOT NULL, LENGTH(100) | ì €ì | í•„ìˆ˜ ì…ë ¥ |
| **publisher** | `String` | `publisher` | LENGTH(100) | ì¶œíŒì‚¬ | ì„ íƒ ì…ë ¥ |
| **publicationDate** | `LocalDate` | `publication_date` | NULL í—ˆìš© | ì¶œê°„ì¼ | ì„ íƒ ì…ë ¥ |
| **totalCopies** | `Integer` | `total_copies` | NOT NULL, MIN(1) | ì´ ë³´ìœ  ê¶Œìˆ˜ | 1 ì´ìƒ |
| **availableCopies** | `Integer` | `available_copies` | NOT NULL, MIN(0) | ëŒ€ì¶œ ê°€ëŠ¥ ê¶Œìˆ˜ | 0 ì´ìƒ |
| **price** | `BigDecimal` | `price` | PRECISION(10,2) | ë„ì„œ ê°€ê²© | ì„ íƒ ì…ë ¥ |
| **description** | `String` | `description` | TEXT | ë„ì„œ ì„¤ëª… | ì„ íƒ ì…ë ¥ |
| **imageUrl** | `String` | `image_url` | LENGTH(500) | í‘œì§€ ì´ë¯¸ì§€ URL | ì„ íƒ ì…ë ¥ |
| **pageCount** | `Integer` | `page_count` | MIN(1) | í˜ì´ì§€ ìˆ˜ | ì„ íƒ ì…ë ¥ |
| **language** | `String` | `language` | LENGTH(10), DEFAULT('KO') | ì–¸ì–´ ì½”ë“œ | KO, EN, JP ë“± |
| **isActive** | `Boolean` | `is_active` | NOT NULL, DEFAULT(true) | í™œì„± ì—¬ë¶€ | ì†Œí”„íŠ¸ ì‚­ì œìš© |

#### 4.2.2 êµ¬í˜„ ì½”ë“œ ì˜ˆì‹œ
```java
@Entity
@Table(name = "books", indexes = {
    @Index(name = "idx_isbn", columnList = "isbn"),
    @Index(name = "idx_title", columnList = "title"),
    @Index(name = "idx_author", columnList = "author"),
    @Index(name = "idx_category", columnList = "category_id"),
    @Index(name = "idx_available", columnList = "available_copies")
})
@EntityListeners(AuditingEntityListener.class)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Getter
public class Book extends BaseEntity {

    @Column(nullable = false, unique = true, length = 13)
    @Pattern(regexp = "^\\d{13}$", message = "ISBNì€ 13ìë¦¬ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤")
    private String isbn;

    @Column(nullable = false, length = 200)
    @NotBlank(message = "ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
    @Size(max = 200, message = "ì œëª©ì€ 200ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    private String title;

    @Column(nullable = false, length = 100)
    @NotBlank(message = "ì €ìëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤")
    private String author;

    @Column(name = "total_copies", nullable = false)
    @Min(value = 1, message = "ì´ ê¶Œìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
    private Integer totalCopies;

    @Column(name = "available_copies", nullable = false)
    @Min(value = 0, message = "ëŒ€ì¶œê°€ëŠ¥ ê¶Œìˆ˜ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
    private Integer availableCopies;

    // ManyToOne - ì¹´í…Œê³ ë¦¬
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "category_id", nullable = false)
    private Category category;

    // OneToMany - ëŒ€ì¶œ ì´ë ¥
    @OneToMany(mappedBy = "book", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<Loan> loans = new ArrayList<>();

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
    public boolean isAvailable() {
        return availableCopies > 0 && isActive;
    }

    public void decreaseAvailableCopies() {
        if (availableCopies <= 0) {
            throw new IllegalStateException("ëŒ€ì¶œ ê°€ëŠ¥í•œ ì±…ì´ ì—†ìŠµë‹ˆë‹¤");
        }
        this.availableCopies--;
    }

    public void increaseAvailableCopies() {
        if (availableCopies >= totalCopies) {
            throw new IllegalStateException("ë°˜ë‚©í•  ìˆ˜ ìˆëŠ” ì±…ì´ ì—†ìŠµë‹ˆë‹¤");
        }
        this.availableCopies++;
    }
}
```

### 4.3 Loan Entity

#### 4.3.1 í•„ë“œ ìƒì„¸ ëª…ì„¸
| í•„ë“œëª… | ë°ì´í„° íƒ€ì… | ì»¬ëŸ¼ëª… | ì œì•½ì¡°ê±´ | ì„¤ëª… | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ |
|--------|-------------|--------|----------|------|---------------|
| **id** | `Long` | `loan_id` | PK, NOT NULL, AUTO_INCREMENT | ëŒ€ì¶œ ê³ ìœ  ì‹ë³„ì | ì‹œìŠ¤í…œ ìë™ ìƒì„± |
| **loanNumber** | `String` | `loan_number` | UNIQUE, NOT NULL, LENGTH(12) | ëŒ€ì¶œë²ˆí˜¸ | L + YYYYMMDD + 4ìë¦¬ |
| **loanDate** | `LocalDate` | `loan_date` | NOT NULL | ëŒ€ì¶œì¼ | ìŠ¹ì¸ì¼ ê¸°ì¤€ |
| **dueDate** | `LocalDate` | `due_date` | NOT NULL | ë°˜ë‚©ì˜ˆì •ì¼ | ëŒ€ì¶œì¼ + 14ì¼ |
| **returnDate** | `LocalDate` | `return_date` | NULL í—ˆìš© | ì‹¤ì œë°˜ë‚©ì¼ | ë°˜ë‚© ì‹œ ì…ë ¥ |
| **status** | `LoanStatus` | `status` | NOT NULL, ENUM | ëŒ€ì¶œìƒíƒœ | REQUESTED, APPROVED, BORROWED, RETURNED, OVERDUE, CANCELLED |
| **overdueFee** | `BigDecimal` | `overdue_fee` | PRECISION(10,2), DEFAULT(0) | ì—°ì²´ë£Œ | 1ì¼ë‹¹ 100ì› |
| **notes** | `String` | `notes` | TEXT | ë¹„ê³  | ì„ íƒ ì…ë ¥ |

#### 4.3.2 êµ¬í˜„ ì½”ë“œ ì˜ˆì‹œ
```java
@Entity
@Table(name = "loans", indexes = {
    @Index(name = "idx_loan_number", columnList = "loan_number"),
    @Index(name = "idx_member_status", columnList = "member_id, status"),
    @Index(name = "idx_book_status", columnList = "book_id, status"),
    @Index(name = "idx_due_date", columnList = "due_date"),
    @Index(name = "idx_status", columnList = "status")
})
@EntityListeners(AuditingEntityListener.class)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Getter
public class Loan extends BaseEntity {

    @Column(name = "loan_number", unique = true, nullable = false, length = 12)
    private String loanNumber;

    @Column(name = "loan_date", nullable = false)
    private LocalDate loanDate;

    @Column(name = "due_date", nullable = false)
    private LocalDate dueDate;

    @Column(name = "return_date")
    private LocalDate returnDate;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private LoanStatus status = LoanStatus.REQUESTED;

    @Column(name = "overdue_fee", precision = 10, scale = 2)
    private BigDecimal overdueFee = BigDecimal.ZERO;

    // ManyToOne ê´€ê³„
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "member_id", nullable = false)
    private Member member;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "book_id", nullable = false)
    private Book book;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "approved_by")
    private Admin approvedBy;

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
    public boolean isOverdue() {
        return status == LoanStatus.BORROWED && 
               LocalDate.now().isAfter(dueDate);
    }

    public long getOverdueDays() {
        if (!isOverdue()) {
            return 0;
        }
        return ChronoUnit.DAYS.between(dueDate, LocalDate.now());
    }

    public BigDecimal calculateOverdueFee() {
        if (!isOverdue()) {
            return BigDecimal.ZERO;
        }
        return BigDecimal.valueOf(getOverdueDays())
                .multiply(new BigDecimal("100")); // 1ì¼ë‹¹ 100ì›
    }

    public void approve(Admin admin) {
        if (this.status != LoanStatus.REQUESTED) {
            throw new IllegalStateException("ìŠ¹ì¸ ê°€ëŠ¥í•œ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤");
        }
        if (!book.isAvailable()) {
            throw new IllegalStateException("ëŒ€ì¶œ ê°€ëŠ¥í•œ ë„ì„œê°€ ì•„ë‹™ë‹ˆë‹¤");
        }
        
        this.status = LoanStatus.APPROVED;
        this.approvedBy = admin;
        this.loanDate = LocalDate.now();
        this.dueDate = this.loanDate.plusDays(14);
        
        // ë„ì„œ ì¬ê³  ê°ì†Œ
        book.decreaseAvailableCopies();
    }

    public void returnBook() {
        if (status != LoanStatus.BORROWED && status != LoanStatus.OVERDUE) {
            throw new IllegalStateException("ë°˜ë‚©í•  ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤");
        }
        
        this.returnDate = LocalDate.now();
        this.status = LoanStatus.RETURNED;
        this.overdueFee = calculateOverdueFee();
        
        // ë„ì„œ ì¬ê³  ì¦ê°€
        book.increaseAvailableCopies();
    }
}
```

---

## 5. Enum íƒ€ì… ì •ì˜

### 5.1 MemberStatus
```java
public enum MemberStatus {
    ACTIVE("í™œì„±", "ì •ìƒì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì´ìš© ê°€ëŠ¥"),
    SUSPENDED("ì •ì§€", "ì¼ì‹œì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì´ìš© ì •ì§€"),
    WITHDRAWN("íƒˆí‡´", "ì„œë¹„ìŠ¤ íƒˆí‡´ ì™„ë£Œ");

    private final String displayName;
    private final String description;

    MemberStatus(String displayName, String description) {
        this.displayName = displayName;
        this.description = description;
    }

    public String getDisplayName() {
        return displayName;
    }

    public String getDescription() {
        return description;
    }

    public boolean isActive() {
        return this == ACTIVE;
    }
}
```

### 5.2 LoanStatus
```java
public enum LoanStatus {
    REQUESTED("ì‹ ì²­", "ëŒ€ì¶œ ì‹ ì²­ ìƒíƒœ"),
    APPROVED("ìŠ¹ì¸", "ê´€ë¦¬ìê°€ ìŠ¹ì¸í•œ ìƒíƒœ"),
    BORROWED("ëŒ€ì¶œì¤‘", "ì‹¤ì œ ëŒ€ì¶œì´ ì§„í–‰ ì¤‘ì¸ ìƒíƒœ"),
    RETURNED("ë°˜ë‚©ì™„ë£Œ", "ì •ìƒ ë°˜ë‚© ì™„ë£Œ"),
    OVERDUE("ì—°ì²´", "ë°˜ë‚©ì¼ì„ ì´ˆê³¼í•œ ìƒíƒœ"),
    CANCELLED("ì·¨ì†Œ", "ëŒ€ì¶œ ì‹ ì²­ì´ ì·¨ì†Œëœ ìƒíƒœ");

    private final String displayName;
    private final String description;

    LoanStatus(String displayName, String description) {
        this.displayName = displayName;
        this.description = description;
    }

    public boolean isActiveStatus() {
        return this == BORROWED || this == OVERDUE;
    }

    public boolean isCompletedStatus() {
        return this == RETURNED || this == CANCELLED;
    }
}
```

---

## 6. ì—°ê´€ê´€ê³„ ë§¤í•‘ ì „ëµ

### 6.1 ì—°ê´€ê´€ê³„ ë§¤í•‘ ê·œì¹™
| ê´€ê³„ ìœ í˜• | ê¸°ë³¸ ì „ëµ | ì´ìœ  | ì˜ˆì™¸ ìƒí™© |
|----------|-----------|------|-----------|
| **@ManyToOne** | LAZY | ì„±ëŠ¥ ìµœì í™” | í•„ìˆ˜ ì¡°íšŒ ë°ì´í„°ëŠ” EAGER |
| **@OneToMany** | LAZY | N+1 ë¬¸ì œ ë°©ì§€ | ì†ŒëŸ‰ ë°ì´í„°ëŠ” EAGER |
| **@OneToOne** | LAZY | ì¼ê´€ì„± ìœ ì§€ | í•­ìƒ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ê²½ìš° EAGER |
| **@ManyToMany** | ì‚¬ìš© ê¸ˆì§€ | ë³µì¡ì„± ì¦ê°€ | ì¤‘ê°„ í…Œì´ë¸”ë¡œ ëŒ€ì²´ |

### 6.2 Cascade ì˜µì…˜ ê°€ì´ë“œ
```java
// ë¶€ëª¨-ìì‹ ê´€ê³„ (ê°•í•œ ì—°ê²°)
@OneToMany(mappedBy = "member", cascade = CascadeType.ALL, orphanRemoval = true)
private List<Loan> loans = new ArrayList<>();

// ì°¸ì¡° ê´€ê³„ (ì•½í•œ ì—°ê²°)
@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "category_id")
private Category category; // cascade ì—†ìŒ

// ì„ íƒì  ê´€ê³„
@OneToMany(mappedBy = "book", cascade = {CascadeType.PERSIST, CascadeType.MERGE})
private List<Reservation> reservations = new ArrayList<>();
```

### 6.3 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê´€ë¦¬
```java
// Member Entityì—ì„œ
public void addLoan(Loan loan) {
    loans.add(loan);
    loan.setMember(this); // ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ë™ê¸°í™”
}

public void removeLoan(Loan loan) {
    loans.remove(loan);
    loan.setMember(null);
}

// Loan Entityì—ì„œ
public void setMember(Member member) {
    // ê¸°ì¡´ ê´€ê³„ ì œê±°
    if (this.member != null) {
        this.member.getLoans().remove(this);
    }
    
    this.member = member;
    
    // ìƒˆë¡œìš´ ê´€ê³„ ì„¤ì •
    if (member != null && !member.getLoans().contains(this)) {
        member.getLoans().add(this);
    }
}
```

---

## 7. ê°ì‚¬(Auditing) ì„¤ì •

### 7.1 BaseEntity êµ¬í˜„
```java
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
@Getter
public abstract class BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Long id;

    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

    @CreatedBy
    @Column(name = "created_by", updatable = false)
    private String createdBy;

    @LastModifiedBy
    @Column(name = "last_modified_by")
    private String lastModifiedBy;

    @Version
    @Column(name = "version")
    private Long version;

    // equals, hashCodeëŠ” id ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        BaseEntity that = (BaseEntity) o;
        return Objects.equals(id, that.id);
    }

    @Override
    public int hashCode() {
        return Objects.hash(id);
    }
}
```

### 7.2 Auditing ì„¤ì •
```java
@Configuration
@EnableJpaAuditing
public class JpaAuditingConfig {

    @Bean
    public AuditorAware<String> auditorProvider() {
        return () -> {
            // Spring Securityì—ì„œ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
            Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
            
            if (authentication == null || !authentication.isAuthenticated()) {
                return Optional.of("SYSTEM");
            }
            
            return Optional.of(authentication.getName());
        };
    }
}
```

---

## 8. ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 8.1 ì¸ë±ìŠ¤ ì„¤ê³„ ì „ëµ
```java
// ë³µí•© ì¸ë±ìŠ¤ - ìì£¼ í•¨ê»˜ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼
@Table(name = "loans", indexes = {
    @Index(name = "idx_member_status", columnList = "member_id, status"),
    @Index(name = "idx_book_status_date", columnList = "book_id, status, loan_date"),
    @Index(name = "idx_due_date_status", columnList = "due_date, status")
})

// ë‹¨ì¼ ì¸ë±ìŠ¤ - ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ìì£¼ ì‚¬ìš©
@Index(name = "idx_loan_number", columnList = "loan_number", unique = true)
@Index(name = "idx_created_at", columnList = "created_at")
```

### 8.2 N+1 ë¬¸ì œ í•´ê²°
```java
// Repositoryì—ì„œ fetch join ì‚¬ìš©
public interface LoanRepository extends JpaRepository<Loan, Long> {
    
    @Query("SELECT l FROM Loan l " +
           "JOIN FETCH l.member m " +
           "JOIN FETCH l.book b " +
           "JOIN FETCH b.category " +
           "WHERE l.status = :status")
    List<Loan> findByStatusWithDetails(@Param("status") LoanStatus status);
    
    // @EntityGraph ì‚¬ìš©
    @EntityGraph(attributePaths = {"member", "book", "book.category"})
    List<Loan> findByMemberIdAndStatus(Long memberId, LoanStatus status);
}
```

### 8.3 ì¿¼ë¦¬ ìµœì í™”
```java
// í˜ì´ì§•ê³¼ ì •ë ¬
@Query("SELECT l FROM Loan l " +
       "WHERE l.member.id = :memberId " +
       "ORDER BY l.createdAt DESC")
Page<Loan> findByMemberIdOrderByCreatedAtDesc(
    @Param("memberId") Long memberId, 
    Pageable pageable);

// ì§‘ê³„ ì¿¼ë¦¬
@Query("SELECT COUNT(l) FROM Loan l " +
       "WHERE l.member.id = :memberId " +
       "AND l.status = :status")
long countByMemberIdAndStatus(
    @Param("memberId") Long memberId, 
    @Param("status") LoanStatus status);

// ì¡°ê±´ë¶€ ì¿¼ë¦¬ (Specifications í™œìš©)
public class LoanSpecifications {
    public static Specification<Loan> hasStatus(LoanStatus status) {
        return (root, query, criteriaBuilder) ->
            status == null ? null : criteriaBuilder.equal(root.get("status"), status);
    }
    
    public static Specification<Loan> isOverdue() {
        return (root, query, criteriaBuilder) ->
            criteriaBuilder.and(
                criteriaBuilder.equal(root.get("status"), LoanStatus.BORROWED),
                criteriaBuilder.lessThan(root.get("dueDate"), LocalDate.now())
            );
    }
}
```

---

## 9. ê²€ì¦ ë° ì œì•½ì¡°ê±´

### 9.1 Bean Validation ì–´ë…¸í…Œì´ì…˜
```java
// ì»¤ìŠ¤í…€ ê²€ì¦ ì–´ë…¸í…Œì´ì…˜
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = ISBNValidator.class)
public @interface ValidISBN {
    String message() default "ìœ íš¨í•˜ì§€ ì•Šì€ ISBNì…ë‹ˆë‹¤";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

// ê²€ì¦ êµ¬í˜„ í´ë˜ìŠ¤
public class ISBNValidator implements ConstraintValidator<ValidISBN, String> {
    
    @Override
    public boolean isValid(String isbn, ConstraintValidatorContext context) {
        if (isbn == null || isbn.length() != 13) {
            return false;
        }
        
        // ISBN-13 ì²´í¬ì„¬ ê²€ì¦ ë¡œì§
        try {
            int sum = 0;
            for (int i = 0; i < 12; i++) {
                int digit = Character.getNumericValue(isbn.charAt(i));
                sum += (i % 2 == 0) ? digit : digit * 3;
            }
            int checkDigit = 10 - (sum % 10);
            if (checkDigit == 10) checkDigit = 0;
            
            return checkDigit == Character.getNumericValue(isbn.charAt(12));
        } catch (NumberFormatException e) {
            return false;
        }
    }
}

// Entityì—ì„œ ì‚¬ìš©
@ValidISBN
@Column(nullable = false, unique = true, length = 13)
private String isbn;
```

### 9.2 ë°ì´í„°ë² ì´ìŠ¤ ì œì•½ì¡°ê±´
```java
// ì²´í¬ ì œì•½ì¡°ê±´
@Entity
@Table(name = "books", 
    uniqueConstraints = {
        @UniqueConstraint(columnNames = {"isbn"}),
        @UniqueConstraint(columnNames = {"title", "author", "publisher"})
    },
    // MySQLì—ì„œëŠ” ì²´í¬ ì œì•½ì¡°ê±´ ëŒ€ì‹  íŠ¸ë¦¬ê±° ì‚¬ìš©
    indexes = {
        @Index(name = "idx_isbn", columnList = "isbn"),
        @Index(name = "idx_title_author", columnList = "title, author")
    }
)
public class Book extends BaseEntity {
    
    // JPA ìˆ˜ì¤€ì—ì„œ ê²€ì¦
    @PrePersist
    @PreUpdate
    private void validateConstraints() {
        if (availableCopies > totalCopies) {
            throw new IllegalArgumentException(
                "ëŒ€ì¶œê°€ëŠ¥ ê¶Œìˆ˜ëŠ” ì´ ê¶Œìˆ˜ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
        }
        if (totalCopies < 1) {
            throw new IllegalArgumentException(
                "ì´ ê¶Œìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤");
        }
    }
}
```

---

## 10. í…ŒìŠ¤íŠ¸ ì „ëµ

### 10.1 Entity ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```java
@DisplayName("Member Entity í…ŒìŠ¤íŠ¸")
class MemberTest {

    @Test
    @DisplayName("íšŒì› ìƒì„± ì‹œ ê¸°ë³¸ê°’ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ì•¼ í•œë‹¤")
    void createMember_ShouldSetDefaultValues() {
        // given
        String name = "ê¹€ì² ìˆ˜";
        String email = "kim@test.com";
        String password = "password123";
        
        // when
        Member member = Member.createMember(name, email, password, null, null, null);
        
        // then
        assertThat(member.getStatus()).isEqualTo(MemberStatus.ACTIVE);
        assertThat(member.getMaxLoanCount()).isEqualTo(5);
        assertThat(member.getMemberNumber()).startsWith("M");
        assertThat(member.getMemberNumber()).hasSize(10);
    }

    @Test
    @DisplayName("ì¶”ê°€ ëŒ€ì¶œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒë‹¨í•´ì•¼ í•œë‹¤")
    void canLoanMore_ShouldReturnCorrectResult() {
        // given
        Member member = createTestMember();
        
        // í˜„ì¬ 5ê¶Œ ëŒ€ì¶œ ì¤‘ (ìµœëŒ€ ëŒ€ì¶œ ê¶Œìˆ˜)
        for (int i = 0; i < 5; i++) {
            Loan loan = createActiveLoan(member);
            member.getLoans().add(loan);
        }
        
        // when & then
        assertThat(member.canLoanMore()).isFalse();
    }

    @Test
    @DisplayName("ì—°ì²´ ë„ì„œ ë³´ìœ  ì—¬ë¶€ë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒë‹¨í•´ì•¼ í•œë‹¤")
    void hasOverdueLoans_ShouldReturnTrue_WhenOverdueLoansExist() {
        // given
        Member member = createTestMember();
        Loan overdueLoan = createOverdueLoan(member);
        member.getLoans().add(overdueLoan);
        
        // when & then
        assertThat(member.hasOverdueLoans()).isTrue();
    }
}
```

### 10.2 Repository í…ŒìŠ¤íŠ¸
```java
@DataJpaTest
@DisplayName("LoanRepository í…ŒìŠ¤íŠ¸")
class LoanRepositoryTest {

    @Autowired
    private TestEntityManager entityManager;

    @Autowired
    private LoanRepository loanRepository;

    @Test
    @DisplayName("íšŒì› IDì™€ ìƒíƒœë¡œ ëŒ€ì¶œ ëª©ë¡ì„ ì¡°íšŒí•´ì•¼ í•œë‹¤")
    void findByMemberIdAndStatus_ShouldReturnLoans() {
        // given
        Member member = createAndSaveMember();
        Book book = createAndSaveBook();
        Loan loan = createAndSaveLoan(member, book, LoanStatus.BORROWED);
        
        // when
        List<Loan> result = loanRepository.findByMemberIdAndStatus(
            member.getId(), LoanStatus.BORROWED);
        
        // then
        assertThat(result).hasSize(1);
        assertThat(result.get(0).getId()).isEqualTo(loan.getId());
    }

    @Test
    @DisplayName("ì—°ì²´ëœ ëŒ€ì¶œ ëª©ë¡ì„ ì¡°íšŒí•´ì•¼ í•œë‹¤")
    void findOverdueLoans_ShouldReturnOverdueLoans() {
        // given
        Member member = createAndSaveMember();
        Book book = createAndSaveBook();
        Loan overdueLoan = createAndSaveLoan(member, book, LoanStatus.BORROWED);
        
        // ë°˜ë‚©ì˜ˆì •ì¼ì„ ê³¼ê±°ë¡œ ì„¤ì •
        overdueLoan.setDueDate(LocalDate.now().minusDays(1));
        entityManager.persistAndFlush(overdueLoan);
        
        // when
        List<Loan> result = loanRepository.findOverdueLoans();
        
        // then
        assertThat(result).hasSize(1);
        assertThat(result.get(0).isOverdue()).isTrue();
    }
}
```

---

## 11. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### 11.1 ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```yaml
# application.yml
logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    
spring:
  jpa:
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        generate_statistics: true
    show-sql: true

# ì„±ëŠ¥ í†µê³„ í™œì„±í™”
management:
  endpoints:
    web:
      exposure:
        include: metrics,health,info
  metrics:
    export:
      simple:
        enabled: true
```

### 11.2 ìŠ¬ë¡œìš° ì¿¼ë¦¬ ê°ì§€
```java
@Component
@Slf4j
public class QueryPerformanceInterceptor implements Interceptor {
    
    private static final long SLOW_QUERY_THRESHOLD = 1000; // 1ì´ˆ
    
    @Override
    public boolean onLoad(Object entity, Serializable id, Object[] state, 
                         String[] propertyNames, Type[] types) {
        long startTime = System.currentTimeMillis();
        
        return new Runnable() {
            @Override
            public void run() {
                long endTime = System.currentTimeMillis();
                long executionTime = endTime - startTime;
                
                if (executionTime > SLOW_QUERY_THRESHOLD) {
                    log.warn("ìŠ¬ë¡œìš° ì¿¼ë¦¬ ê°ì§€: {}ms, Entity: {}, ID: {}", 
                            executionTime, entity.getClass().getSimpleName(), id);
                }
            }
        };
    }
}
```

---

## 12. ë°°í¬ ë° ë§ˆì´ê·¸ë ˆì´ì…˜

### 12.1 Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
```sql
-- V1__Create_base_tables.sql
CREATE TABLE members (
    member_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    member_number VARCHAR(10) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    phone_number VARCHAR(15),
    birth_date DATE,
    address VARCHAR(200),
    status ENUM('ACTIVE', 'SUSPENDED', 'WITHDRAWN') NOT NULL DEFAULT 'ACTIVE',
    max_loan_count INT NOT NULL DEFAULT 5,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    last_modified_by VARCHAR(50),
    version BIGINT DEFAULT 0,
    
    INDEX idx_member_number (member_number),
    INDEX idx_email (email),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- V2__Create_books_table.sql
CREATE TABLE categories (
    category_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    category_code VARCHAR(10) NOT NULL UNIQUE,
    category_name VARCHAR(50) NOT NULL,
    parent_category_id BIGINT,
    description TEXT,
    sort_order INT NOT NULL DEFAULT 0,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (parent_category_id) REFERENCES categories(category_id),
    INDEX idx_parent_category (parent_category_id),
    INDEX idx_sort_order (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE books (
    book_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    isbn VARCHAR(13) NOT NULL UNIQUE,
    title VARCHAR(200) NOT NULL,
    author VARCHAR(100) NOT NULL,
    publisher VARCHAR(100),
    publication_date DATE,
    total_copies INT NOT NULL DEFAULT 1,
    available_copies INT NOT NULL DEFAULT 1,
    price DECIMAL(10,2),
    description TEXT,
    image_url VARCHAR(500),
    page_count INT,
    language VARCHAR(10) DEFAULT 'KO',
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    category_id BIGINT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    last_modified_by VARCHAR(50),
    version BIGINT DEFAULT 0,
    
    FOREIGN KEY (category_id) REFERENCES categories(category_id),
    INDEX idx_isbn (isbn),
    INDEX idx_title (title),
    INDEX idx_author (author),
    INDEX idx_category (category_id),
    INDEX idx_available (available_copies),
    FULLTEXT idx_search (title, author, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 12.2 í™˜ê²½ë³„ ì„¤ì •
```yaml
# application-dev.yml (ê°œë°œí™˜ê²½)
spring:
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  h2:
    console:
      enabled: true

# application-prod.yml (ìš´ì˜í™˜ê²½)
spring:
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
```

---

## 13. ì²´í¬ë¦¬ìŠ¤íŠ¸ ë° ê²€í†  í•­ëª©

### 13.1 ì„¤ê³„ ì™„ì„±ë„ ì²´í¬ë¦¬ìŠ¤íŠ¸
```
â–¡ ëª¨ë“  Entityì— @Entity ì–´ë…¸í…Œì´ì…˜ì´ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ í…Œì´ë¸”ëª…ê³¼ ì»¬ëŸ¼ëª…ì´ ëª…ëª… ê·œì¹™ì„ ë”°ë¥´ëŠ”ê°€?
â–¡ Primary Key ì „ëµì´ ì¼ê´€ë˜ê²Œ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ í•„ìš”í•œ ì¸ë±ìŠ¤ê°€ ëª¨ë‘ ì •ì˜ë˜ì—ˆëŠ”ê°€?
â–¡ ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
â–¡ ê²€ì¦ ì–´ë…¸í…Œì´ì…˜ì´ ì ì ˆíˆ ì‚¬ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œê°€ Entityì— í¬í•¨ë˜ì—ˆëŠ”ê°€?
â–¡ equals/hashCodeê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆëŠ”ê°€?
â–¡ ê°ì‚¬(Auditing) ê¸°ëŠ¥ì´ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ ì„±ëŠ¥ ìµœì í™”ê°€ ê³ ë ¤ë˜ì—ˆëŠ”ê°€?
```

### 13.2 ì½”ë“œ í’ˆì§ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸
```
â–¡ ëª¨ë“  í•„ë“œì— ì ì ˆí•œ ì ‘ê·¼ ì œì–´ìê°€ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
â–¡ ë¶ˆë³€ ê°ì²´ ì›ì¹™ì´ ìµœëŒ€í•œ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ ìƒì„±ìì™€ íŒ©í† ë¦¬ ë©”ì„œë“œê°€ ì ì ˆíˆ êµ¬í˜„ë˜ì—ˆëŠ”ê°€?
â–¡ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œì— í¬í•¨ë˜ì—ˆëŠ”ê°€?
â–¡ ì½”ë“œ ì¤‘ë³µì´ ìµœì†Œí™”ë˜ì—ˆëŠ”ê°€?
â–¡ ì£¼ì„ê³¼ ë¬¸ì„œí™”ê°€ ì¶©ë¶„í•œê°€?
â–¡ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì‘ì„±ë˜ì—ˆëŠ”ê°€?
â–¡ ì½”ë”© ì»¨ë²¤ì…˜ì´ ì¼ê´€ë˜ê²Œ ì ìš©ë˜ì—ˆëŠ”ê°€?
```

### 13.3 ì„±ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸
```
â–¡ N+1 ì¿¼ë¦¬ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆëŠ”ê°€?
â–¡ ì ì ˆí•œ í˜ì¹˜ ì „ëµ(LAZY/EAGER)ì´ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ í•„ìš”í•œ ì¸ë±ìŠ¤ê°€ ëª¨ë‘ ìƒì„±ë˜ì—ˆëŠ”ê°€?
â–¡ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ê°€ ê³ ë ¤ë˜ì—ˆëŠ”ê°€?
â–¡ ì¿¼ë¦¬ ìµœì í™”ê°€ ì ìš©ë˜ì—ˆëŠ”ê°€?
â–¡ ìºì‹œ ì „ëµì´ ê³ ë ¤ë˜ì—ˆëŠ”ê°€?
â–¡ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì´ ì ì ˆíˆ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
```

---

## 14. ë§ˆë¬´ë¦¬

### 14.1 ì£¼ìš” í¬ì¸íŠ¸ ìš”ì•½
1. **ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ Entityì— ìº¡ìŠí™”
2. **ì„±ëŠ¥ ìµœì í™”**: ì¸ë±ìŠ¤, í˜ì¹˜ ì „ëµ, ì¿¼ë¦¬ ìµœì í™” ê³ ë ¤
3. **ì¼ê´€ëœ ê·œì¹™**: ëª…ëª… ê·œì¹™, ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©ë²• í†µì¼
4. **ê²€ì¦ ë° ì œì•½ì¡°ê±´**: ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
5. **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ ê³ ë ¤

### 14.2 í–¥í›„ ê³ ë„í™” ë°©ì•ˆ
- **ìºì‹œ ì ìš©**: Redisë¥¼ í™œìš©í•œ 2ì°¨ ìºì‹œ êµ¬í˜„
- **ì½ê¸° ì „ìš© ë³µì œë³¸**: ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”
- **ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜**: ë„ë©”ì¸ ì´ë²¤íŠ¸ í™œìš©
- **CQRS íŒ¨í„´**: ëª…ë ¹ê³¼ ì¡°íšŒ ë¶„ë¦¬
- **ê°ì‚¬ ë¡œê·¸**: ë°ì´í„° ë³€ê²½ ì´ë ¥ ìƒì„¸ ì¶”ì 

---

**ì´ Entity ì„¤ê³„ì„œëŠ” ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.**
**íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ì´ í…œí”Œë¦¿ì„ ì°¸ê³ í•˜ì—¬ ê²¬ê³ í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ Entityë¥¼ ì„¤ê³„í•˜ì„¸ìš”!** ğŸš€